import"./modulepreload-polyfill-B5Qt9EMX.js";import{f as y}from"./fetch-CGUiTqyx.js";import{s as d}from"./snackbar-BNtgsuzo.js";document.addEventListener("DOMContentLoaded",()=>{document.querySelector(".answer-form-all").addEventListener("keypress",function(a){if(a.keyCode===13)return a.preventDefault(),!1})});document.getElementById("submitButton").addEventListener("click",function(){const t=document.getElementById("question14"),a=t.value.trim();if(a!==""){let o=[];const n=document.querySelector('input[name="activities"]');n&&(o=JSON.parse(n.value),n.remove()),o.push(a);const s=document.createElement("input");s.type="hidden",s.name="activities",s.value=JSON.stringify(o),document.querySelector(".answer-form-all").appendChild(s),t.value="",k(o),d("green","Aktiviteetti lisätty, voit halutessasi lisätä useamman")}else l("Lisää aktiviteettejä ennen alkukartoituksen lähettämistä.")});function k(t){const a=document.getElementById("activitiesList");a.innerHTML="",t.forEach(o=>{const n=document.createElement("li");n.textContent=o,a.appendChild(n)})}const p=document.getElementById("popup"),u=document.getElementById("overlay"),f=document.getElementById("yes"),h=document.getElementById("closePopup"),v=document.getElementById("popup2"),g=document.querySelector(".submitdoc"),E=document.getElementById("closePopup2");f.addEventListener("click",function(t){t.preventDefault(),p.style.display="block",u.style.display="block"});h.addEventListener("click",function(){p.style.display="none",u.style.display="none"});g.addEventListener("click",function(t){t.preventDefault(),v.style.display="block",u.style.display="block"});E.addEventListener("click",function(){v.style.display="none",u.style.display="none"});function l(t){document.getElementById("alertMessage").textContent=t,document.getElementById("customAlert").style.display="block",document.getElementById("customOverlay").style.display="block"}document.addEventListener("DOMContentLoaded",()=>{const t=document.getElementById("closeAlertButton");t?t.addEventListener("click",S):console.log("Close alert button not found!")});function S(){document.getElementById("customAlert").style.display="none",document.getElementById("customOverlay").style.display="none"}async function I(){const o=`https://hyte-server-aleksi.northeurope.cloudapp.azure.com/api/users/find-doctor/${document.getElementById("doctor_email").value.trim()}`,s={method:"GET",headers:{"Content-Type":"application/json",Authorization:"Bearer "+localStorage.getItem("token")}};try{const i=await fetch(o,s),r=await i.json();if(console.log(i),console.log(r),i.ok&&r){console.log("Doctor found:",r);const c=r.found_doctor.username,e=r.found_doctor.full_name;return localStorage.setItem("Paired_doc_name",c),localStorage.setItem("doc_name",e),console.log(c),document.getElementById("popup2").style.display="block",document.getElementById("overlay").style.display="block",r}else return l("Sähköpostiosoitetta ei löytynyt"),document.getElementById("popup2").style.display="none",document.getElementById("overlay").style.display="none",null}catch(i){console.error("Error finding doctor:",i),l("Virhe etsiessä lääkäriä, yritä uudelleen.")}}async function B(){const t=localStorage.getItem("Paired_doc_name"),a="https://hyte-server-aleksi.northeurope.cloudapp.azure.com/api/users/create-pair",o=localStorage.getItem("token");if(!t){l("Lääkäriä ei löytynyt.");return}const n={method:"POST",headers:{"Content-Type":"application/json",Authorization:"Bearer "+o},body:JSON.stringify({doctor_username:t})};try{const s=await fetch(a,n);if(s.ok){const i=await s.json();console.log("Doctor pairing successful:",i),d("#9BCF53","Lääkäri yhdistetty onnistuneesti.")}else return l("Lääkäriä ei pystytty yhdistämään."),preventDefault(),null}catch(s){return console.error("Error creating doctor pair:",s),l("Lääkäriä ei pystytty yhdistämään."),null}}const b=document.querySelector(".submitdoc");b.addEventListener("click",()=>{I()});const T=document.getElementById("no");T.addEventListener("click",async t=>{t.preventDefault(),console.log("Nyt palautetaan vastauslomake");const a="https://hyte-server-aleksi.northeurope.cloudapp.azure.com/api/survey",o=document.querySelector(".answer-form-all");if(!o.checkValidity()){o.reportValidity();return}console.log("Tiedot valideja, jatketaan");const n=o.querySelector('input[name="activities"]'),s=n?JSON.parse(n.value):[];if(s.length===0){console.log("No activities added. Survey will not be submitted."),l("Tapahtui virhe. Tarkista, että olet vastannut kaikkiin pakollisiin kysymyksiin ja yritä uudelleen.");return}const i={};o.querySelectorAll("input, select").forEach(e=>{!e.name||e.name==="user_choice"||e.value===""||(e.name==="activities"?i["Mitä aktiviteetteja hyödynnät stressin lievennyksessä?"]=s:i[e.previousElementSibling.textContent.trim()]=e.value)}),console.log(i);const c={method:"POST",headers:{"Content-Type":"application/json",Authorization:"Bearer "+localStorage.getItem("token")},body:JSON.stringify(i)};try{const e=await y(a,c);console.log(e),e.ok||console.error("Failed to submit survey:",e),console.log("Survey submitted successfully"),l("Alkukartoitus on nyt suoritettu. Sinut uudelleenohjataan kalenterisivulle."),setTimeout(()=>{sessionStorage.setItem("fromSurveyPage",!0),window.location.href="../home/patienthome.html"},3e3)}catch(e){console.error("Error submitting form data:",e),l("Tapahtui virhe. Tarkista, että olet vastannut kaikkiin pakollisiin kysymyksiin ja yritä uudelleen.")}});const m=document.querySelector(".doctor_form2");m&&m.addEventListener("submit",async function(t){t.preventDefault(),console.log("Submit button clicked"),console.log("Nyt palautetaan vastauslomake");const a="https://hyte-server-aleksi.northeurope.cloudapp.azure.com/api/survey",o=document.querySelector(".answer-form-all");if(!o.checkValidity()){o.reportValidity();return}console.log("Tiedot valideja, jatketaan");const n={};o.querySelectorAll("input, select").forEach(e=>{!e.name||e.name==="user_choice"||e.value===""||(e.name==="activities"?n["Mitä aktiviteetteja hyödynnät stressin lievennyksessä?"]=JSON.parse(e.value):n[e.previousElementSibling.textContent.trim()]=e.value)}),console.log(n);const s=localStorage.getItem("token"),i=o.querySelector('input[name="activities"]');if((i?JSON.parse(i.value):[]).length===0){console.log("No activities added. Survey will not be submitted."),l("Tapahtui virhe. Tarkista, että olet vastannut kaikkiin pakollisiin kysymyksiin ja yritä uudelleen.");return}const c={method:"POST",headers:{"Content-Type":"application/json",Authorization:"Bearer "+s},body:JSON.stringify(n)};try{const e=await y(a,c);console.log(e),e.ok||console.error("Failed to submit survey:",e),console.log("Survey submitted successfully"),l("Alkukartoitus on nyt suoritettu. Sinut uudelleenohjataan kalenterisivulle."),B(),setTimeout(()=>{sessionStorage.setItem("fromSurveyPage",!0),window.location.href="../home/patienthome.html"},3e3)}catch(e){console.error("Error submitting form data:",e),d("Red","Tapahtui virhe. Tarkista, että olet vastannut kaikkiin pakollisiin kysymyksiin ja yritä uudelleen.")}});
