import"./modulepreload-polyfill-B5Qt9EMX.js";import{f as m}from"./fetch-CGUiTqyx.js";import{s as c}from"./snackbar-BNtgsuzo.js";document.addEventListener("DOMContentLoaded",()=>{document.querySelector(".answer-form-all").addEventListener("keypress",function(s){if(s.keyCode===13)return s.preventDefault(),!1})});document.getElementById("submitButton").addEventListener("click",function(){const t=document.getElementById("question14"),s=t.value.trim();if(s!==""){let n=[];const o=document.querySelector('input[name="activities"]');o&&(n=JSON.parse(o.value),o.remove()),n.push(s);const l=document.createElement("input");l.type="hidden",l.name="activities",l.value=JSON.stringify(n),document.querySelector(".answer-form-all").appendChild(l),t.value="",f(n),c("green","Aktiviteetti lisätty, voit halutessasi lisätä useamman")}else r("Lisää aktiviteettejä ennen alkukartoituksen lähettämistä.")});function f(t){const s=document.getElementById("activitiesList");s.innerHTML="",t.forEach(n=>{const o=document.createElement("li");o.textContent=n,s.appendChild(o)})}const y=document.getElementById("popup"),a=document.getElementById("overlay"),v=document.getElementById("yes"),g=document.getElementById("closePopup"),p=document.getElementById("popup2"),h=document.querySelector(".submitdoc"),E=document.getElementById("closePopup2");v.addEventListener("click",function(t){t.preventDefault(),y.style.display="block",a.style.display="block"});g.addEventListener("click",function(){y.style.display="none",a.style.display="none"});h.addEventListener("click",function(t){t.preventDefault(),p.style.display="block",a.style.display="block"});E.addEventListener("click",function(){p.style.display="none",a.style.display="none"});function r(t){document.getElementById("alertMessage").textContent=t,document.getElementById("customAlert").style.display="block",document.getElementById("customOverlay").style.display="block"}document.addEventListener("DOMContentLoaded",()=>{const t=document.getElementById("closeAlertButton");t?t.addEventListener("click",S):console.log("Close alert button not found!")});function S(){document.getElementById("customAlert").style.display="none",document.getElementById("customOverlay").style.display="none"}async function I(){const n=`http://127.0.0.1:3000/api/users/find-doctor/${document.getElementById("doctor_email").value.trim()}`,l={method:"GET",headers:{"Content-Type":"application/json",Authorization:"Bearer "+localStorage.getItem("token")}};try{const i=await fetch(n,l),e=await i.json();if(console.log(i),console.log(e),i.ok&&e){console.log("Doctor found:",e);const u=e.found_doctor.username,k=e.found_doctor.full_name;return localStorage.setItem("Paired_doc_name",u),localStorage.setItem("doc_name",k),console.log(u),document.getElementById("popup2").style.display="block",document.getElementById("overlay").style.display="block",e}else return r("Sähköpostiosoitetta ei löytynyt"),document.getElementById("popup2").style.display="none",document.getElementById("overlay").style.display="none",null}catch(i){console.error("Error finding doctor:",i),r("Virhe etsiessä lääkäriä, yritä uudelleen.")}}async function B(){const t=localStorage.getItem("Paired_doc_name"),s="http://127.0.0.1:3000/api/users/create-pair",n=localStorage.getItem("token");if(!t){r("Lääkäriä ei löytynyt.");return}const o={method:"POST",headers:{"Content-Type":"application/json",Authorization:"Bearer "+n},body:JSON.stringify({doctor_username:t})};try{const l=await fetch(s,o);if(l.ok){const i=await l.json();console.log("Doctor pairing successful:",i),c("#9BCF53","Lääkäri yhdistetty onnistuneesti.")}else return r("Lääkäriä ei pystytty yhdistämään."),preventDefault(),null}catch(l){return console.error("Error creating doctor pair:",l),r("Lääkäriä ei pystytty yhdistämään."),null}}const b=document.querySelector(".submitdoc");b.addEventListener("click",()=>{I()});const L=document.getElementById("no");L.addEventListener("click",async t=>{t.preventDefault(),console.log("Nyt palautetaan vastauslomake");const s="http://127.0.0.1:3000/api/survey",n=document.querySelector(".answer-form-all");if(!n.checkValidity()){n.reportValidity();return}console.log("Tiedot valideja, jatketaan");const o={};n.querySelectorAll("input, select").forEach(e=>{!e.name||e.name==="user_choice"||e.value===""||(e.name==="activities"?o["Mitä aktiviteetteja hyödynnät stressin lievennyksessä?"]=JSON.parse(e.value):o[e.previousElementSibling.textContent.trim()]=e.value)}),console.log(o);const i={method:"POST",headers:{"Content-Type":"application/json",Authorization:"Bearer "+localStorage.getItem("token")},body:JSON.stringify(o)};try{const e=await m(s,i);console.log(e),e.ok||console.error("Failed to submit survey:",e),console.log("Survey submitted successfully"),r("Alkukartoitus on nyt suoritettu. Sinut uudelleenohjataan kalenterisivulle."),setTimeout(()=>{sessionStorage.setItem("fromSurveyPage",!0),window.location.href="../home/patienthome.html"},3e3)}catch(e){console.error("Error submitting form data:",e),r("Tapahtui virhe. Tarkista, että olet vastannut kaikkiin pakollisiin kysymyksiin ja yritä uudelleen.")}});const d=document.querySelector(".doctor_form2");d&&d.addEventListener("submit",async function(t){t.preventDefault(),console.log("Submit button clicked"),console.log("Nyt palautetaan vastauslomake");const s="http://127.0.0.1:3000/api/survey",n=document.querySelector(".answer-form-all");if(!n.checkValidity()){n.reportValidity();return}console.log("Tiedot valideja, jatketaan");const o={};n.querySelectorAll("input, select").forEach(e=>{!e.name||e.name==="user_choice"||e.value===""||(e.name==="activities"?o["Mitä aktiviteetteja hyödynnät stressin lievennyksessä?"]=JSON.parse(e.value):o[e.previousElementSibling.textContent.trim()]=e.value)}),console.log(o);const i={method:"POST",headers:{"Content-Type":"application/json",Authorization:"Bearer "+localStorage.getItem("token")},body:JSON.stringify(o)};try{const e=await m(s,i);console.log(e),e.ok||console.error("Failed to submit survey:",e),console.log("Survey submitted successfully"),r("Alkukartoitus on nyt suoritettu. Sinut uudelleenohjataan kalenterisivulle."),B(),setTimeout(()=>{sessionStorage.setItem("fromSurveyPage",!0),window.location.href="../home/patienthome.html"},3e3)}catch(e){console.error("Error submitting form data:",e),c("Red","Tapahtui virhe. Tarkista, että olet vastannut kaikkiin pakollisiin kysymyksiin ja yritä uudelleen.")}});
