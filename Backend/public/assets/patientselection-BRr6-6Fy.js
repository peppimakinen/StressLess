import"./modulepreload-polyfill-B5Qt9EMX.js";import{f}from"./fetch-CGUiTqyx.js";import{s as r}from"./snackbar-BNtgsuzo.js";window.addEventListener("DOMContentLoaded",async()=>{try{const i="http://127.0.0.1:3000/api/users/doctor/patients",p={method:"GET",headers:{Authorization:"Bearer "+localStorage.getItem("token")}},c=await f(i,p),s=document.querySelector(".clients");Object.keys(c).length===0?s.textContent="Käyttäjätililläsi ei ole vielä yhtään potilastiliä liitettynä.":c.forEach((e,E)=>{const t=document.createElement("li");t.classList.add("client-container");const a=document.createElement("span");a.classList.add("client-name"),a.textContent=e.full_name;const n=document.createElement("a");n.href=`../home/doctorhome.html?client=${e.user_id}`,n.textContent="Näytä asiakastili",n.addEventListener("click",function(l){localStorage.setItem("full_name",e.full_name)});const o=document.createElement("button");o.classList.add("delete"),o.textContent="X",o.dataset.userId=e.user_id,o.addEventListener("click",async function(l){l.preventDefault();const h=l.target.dataset.userId;document.getElementById("deleteModal").style.display="block";const m=document.querySelector(".close");m&&m.addEventListener("click",function(){document.getElementById("deleteModal").style.display="none"}),document.getElementById("confirmDeletion").addEventListener("click",async function(){if(document.getElementById("deleteConfirm").value==="Poista tili")try{if((await fetch(`http://127.0.0.1:3000/api/users/doctor/delete-patient/${h}`,{method:"DELETE",headers:{Authorization:`Bearer ${localStorage.getItem("token")}`}})).ok)r("Green","Tili poistettu onnistuneesti"),setTimeout(()=>{window.location.href="./patientSelection.html"},3e3),s.removeChild(t);else throw new Error("Failed to delete account")}catch(u){r("Red",u.message)}else r("Red","Poistaminen epäonnistui: väärä teksti");document.getElementById("deleteModal").style.display="none"})});const d=document.createElement("li");d.classList.add("client"),d.textContent=e.full_name,document.createElement("div").classList.add("reports"),n.href=`../home/doctorhome.html?client=${e.user_id}`,n.textContent="Näytä asiakastili",t.appendChild(o),t.appendChild(a),t.appendChild(n),s.appendChild(t)})}catch(i){console.error("Error fetching report:",i)}});
