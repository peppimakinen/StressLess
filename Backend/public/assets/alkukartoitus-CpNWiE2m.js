import"./modulepreload-polyfill-B5Qt9EMX.js";import{f as m}from"./fetch-CGUiTqyx.js";import{s as c}from"./snackbar-BNtgsuzo.js";document.addEventListener("DOMContentLoaded",()=>{document.querySelector(".answer-form-all").addEventListener("keypress",function(s){if(s.keyCode===13)return s.preventDefault(),!1})});document.getElementById("submitButton").addEventListener("click",function(){const t=document.getElementById("question14"),s=t.value.trim();if(s!==""){let n=[];const o=document.querySelector('input[name="activities"]');o&&(n=JSON.parse(o.value),o.remove()),n.push(s);const r=document.createElement("input");r.type="hidden",r.name="activities",r.value=JSON.stringify(n),document.querySelector(".answer-form-all").appendChild(r),t.value="",v(n),c("green","Aktiviteetti lisätty, voit halutessasi lisätä useamman")}else a("Lisää aktiviteettejä ennen alkukartoituksen lähettämistä.")});function v(t){const s=document.getElementById("activitiesList");s.innerHTML="",t.forEach(n=>{const o=document.createElement("li");o.textContent=n,s.appendChild(o)})}const y=document.getElementById("popup"),i=document.getElementById("overlay"),f=document.getElementById("yes"),h=document.getElementById("closePopup"),p=document.getElementById("popup2"),g=document.querySelector(".submitdoc"),E=document.getElementById("closePopup2");f.addEventListener("click",function(t){t.preventDefault(),y.style.display="block",i.style.display="block"});h.addEventListener("click",function(){y.style.display="none",i.style.display="none"});g.addEventListener("click",function(t){t.preventDefault(),p.style.display="block",i.style.display="block"});E.addEventListener("click",function(){p.style.display="none",i.style.display="none"});function a(t){document.getElementById("alertMessage").textContent=t,document.getElementById("customAlert").style.display="block",document.getElementById("customOverlay").style.display="block"}document.addEventListener("DOMContentLoaded",()=>{const t=document.getElementById("closeAlertButton");t?t.addEventListener("click",S):console.log("Close alert button not found!")});function S(){document.getElementById("customAlert").style.display="none",document.getElementById("customOverlay").style.display="none"}async function I(){const n=`https://hyte-server-aleksi.northeurope.cloudapp.azure.com/api/users/find-doctor/${document.getElementById("doctor_email").value.trim()}`,r={method:"GET",headers:{"Content-Type":"application/json",Authorization:"Bearer "+localStorage.getItem("token")}};try{const l=await fetch(n,r),e=await l.json();if(console.log(l),console.log(e),l.ok&&e){console.log("Doctor found:",e);const u=e.found_doctor.username,k=e.found_doctor.full_name;return localStorage.setItem("Paired_doc_name",u),localStorage.setItem("doc_name",k),console.log(u),document.getElementById("popup2").style.display="block",document.getElementById("overlay").style.display="block",e}else return a("Sähköpostiosoitetta ei löytynyt"),document.getElementById("popup2").style.display="none",document.getElementById("overlay").style.display="none",null}catch(l){console.error("Error finding doctor:",l),a("Virhe etsiessä lääkäriä, yritä uudelleen.")}}async function B(){const t=localStorage.getItem("Paired_doc_name"),s="https://hyte-server-aleksi.northeurope.cloudapp.azure.com/api/users/create-pair",n=localStorage.getItem("token");if(!t){a("Lääkäriä ei löytynyt.");return}const o={method:"POST",headers:{"Content-Type":"application/json",Authorization:"Bearer "+n},body:JSON.stringify({doctor_username:t})};try{const r=await fetch(s,o);if(r.ok){const l=await r.json();console.log("Doctor pairing successful:",l),c("#9BCF53","Lääkäri yhdistetty onnistuneesti.")}else return a("Lääkäriä ei pystytty yhdistämään."),preventDefault(),null}catch(r){return console.error("Error creating doctor pair:",r),a("Lääkäriä ei pystytty yhdistämään."),null}}const b=document.querySelector(".submitdoc");b.addEventListener("click",()=>{I()});const L=document.getElementById("no");L.addEventListener("click",async t=>{t.preventDefault(),console.log("Nyt palautetaan vastauslomake");const s="https://hyte-server-aleksi.northeurope.cloudapp.azure.com/api/survey",n=document.querySelector(".answer-form-all");if(!n.checkValidity()){n.reportValidity();return}console.log("Tiedot valideja, jatketaan");const o={};n.querySelectorAll("input, select").forEach(e=>{!e.name||e.name==="user_choice"||e.value===""||(e.name==="activities"?o["Mitä aktiviteetteja hyödynnät stressin lievennyksessä?"]=JSON.parse(e.value):o[e.previousElementSibling.textContent.trim()]=e.value)}),console.log(o);const l={method:"POST",headers:{"Content-Type":"application/json",Authorization:"Bearer "+localStorage.getItem("token")},body:JSON.stringify(o)};try{const e=await m(s,l);console.log(e),e.ok||console.error("Failed to submit survey:",e),console.log("Survey submitted successfully"),a("Alkukartoitus on nyt suoritettu. Sinut uudelleenohjataan kalenterisivulle."),setTimeout(()=>{sessionStorage.setItem("fromSurveyPage",!0),window.location.href="../home/patienthome.html"},3e3)}catch(e){console.error("Error submitting form data:",e),a("Tapahtui virhe. Tarkista, että olet vastannut kaikkiin pakollisiin kysymyksiin ja yritä uudelleen.")}});const d=document.querySelector(".doctor_form2");d&&d.addEventListener("submit",async function(t){t.preventDefault(),console.log("Submit button clicked"),console.log("Nyt palautetaan vastauslomake");const s="https://hyte-server-aleksi.northeurope.cloudapp.azure.com/api/survey",n=document.querySelector(".answer-form-all");if(!n.checkValidity()){n.reportValidity();return}console.log("Tiedot valideja, jatketaan");const o={};n.querySelectorAll("input, select").forEach(e=>{!e.name||e.name==="user_choice"||e.value===""||(e.name==="activities"?o["Mitä aktiviteetteja hyödynnät stressin lievennyksessä?"]=JSON.parse(e.value):o[e.previousElementSibling.textContent.trim()]=e.value)}),console.log(o);const l={method:"POST",headers:{"Content-Type":"application/json",Authorization:"Bearer "+localStorage.getItem("token")},body:JSON.stringify(o)};try{const e=await m(s,l);console.log(e),e.ok||console.error("Failed to submit survey:",e),console.log("Survey submitted successfully"),a("Alkukartoitus on nyt suoritettu. Sinut uudelleenohjataan kalenterisivulle."),B(),setTimeout(()=>{sessionStorage.setItem("fromSurveyPage",!0),window.location.href="../home/patienthome.html"},3e3)}catch(e){console.error("Error submitting form data:",e),c("Red","Tapahtui virhe. Tarkista, että olet vastannut kaikkiin pakollisiin kysymyksiin ja yritä uudelleen.")}});
